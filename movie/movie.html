<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/design.css">
  <link rel="shortcut icon" href="image/jaydoit.png" type="image/png">
  <title>Movie Recommendations</title>
</head>
<body>

<header>
  <h1><a href="movie.html">Movies</a></h1>
  <form id="searchForm">
    <input id="searchInput" placeholder="Search movies..." />
    <button>Search</button>
  </form>
  <button id="themeToggle" class="secondary">üåô</button>
</header>

<main id="movieGrid"></main>
<section id="movieDetails" class="details" hidden></section>
<div id="trailerModal" class="modal" onclick="this.style.display='none'"></div>
<footer>Powered by TMDb ‚Ä¢ @Nash</footer>

<script>
  const API_KEY = "6873a513b7e787b78b332282e98ee6eb";
  const BASE_URL = "https://api.themoviedb.org/3";
  const IMG = "https://image.tmdb.org/t/p/w500";

  const grid = document.getElementById('movieGrid');
  const details = document.getElementById('movieDetails');
  const modal = document.getElementById('trailerModal');

  async function fetchTrending(){
    const r = await fetch(`${BASE_URL}/trending/movie/week?api_key=${API_KEY}`);
    const d = await r.json(); renderMovies(d.results);
  }

  async function renderMovies(movies){
    details.hidden = true; grid.innerHTML = '';
    movies.forEach(m=>{
      const c = document.createElement('div'); c.className='card';
      c.innerHTML = `<img src='${m.poster_path?IMG+m.poster_path:''}'><div class='card-body'><h3>${m.title}</h3><p>‚≠ê ${m.vote_average}</p></div>`;
      c.onclick=()=>showDetails(m.id);
      grid.appendChild(c);
    });
  }

  async function showDetails(id){
    const [m,c,r,v] = await Promise.all([
      fetch(`${BASE_URL}/movie/${id}?api_key=${API_KEY}`).then(r=>r.json()),
      fetch(`${BASE_URL}/movie/${id}/credits?api_key=${API_KEY}`).then(r=>r.json()),
      fetch(`${BASE_URL}/movie/${id}/recommendations?api_key=${API_KEY}`).then(r=>r.json()),
      fetch(`${BASE_URL}/movie/${id}/videos?api_key=${API_KEY}`).then(r=>r.json())
    ]);

    grid.innerHTML=''; details.hidden=false;
    const trailer = v.results.find(x => (x.type==='Trailer'||x.type==='Teaser') && x.site==='YouTube');

    details.innerHTML = `
      <span class='back' onclick='location.reload()'>‚Üê Back</span>
      <div class='details-container'>
        <img src='${IMG+m.poster_path}'>
        <div>
          <h2>${m.title}</h2>
          <p>${m.overview}</p>
          ${trailer ? `<button onclick="openTrailer('${trailer.key}')">‚ñ∂ Watch Trailer</button>` : `<p>No trailer available</p>`}

          <h3 class='section-title'>Cast</h3>
          <div class='cast'>${c.cast.slice(0,8).map(x=>`<div><img src='${x.profile_path?IMG+x.profile_path:''}'><div>${x.name}</div></div>`).join('')}</div>

          <h3 class='section-title'>Recommended for You</h3>
          <div class='recommendations'>${r.results.slice(0,6).map(x=>`<div onclick='showDetails(${x.id})'><img src='${IMG+x.poster_path}'><div>${x.title}</div></div>`).join('')}</div>
        </div>
      </div>`;
  }

  function openTrailer(key){
    modal.style.display='flex';
    modal.innerHTML=`<iframe src='https://www.youtube.com/embed/${key}?autoplay=1' allowfullscreen></iframe>`;
  }

  document.getElementById('searchForm').onsubmit=e=>{ e.preventDefault(); const q=searchInput.value.trim(); if(q) fetch(`${BASE_URL}/search/movie?api_key=${API_KEY}&query=${q}`).then(r=>r.json()).then(d=>renderMovies(d.results)); };
  themeToggle.onclick=()=>{ document.body.classList.toggle('dark'); themeToggle.textContent=document.body.classList.contains('dark')?'‚òÄ':'üåô'; };
  document.addEventListener('keydown', e => { if(e.key==='Escape') modal.style.display='none'; });

  fetchTrending();
</script>
</body>
</html>



